<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{.OptionA}} vs {{.OptionB}} -- Result</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' href='/css/site.css' />
</head>
<body>
<div id="background-stats">
    <div id="background-stats-1"></div>
    <div id="background-stats-2"></div>
</div>
<div id="content-container">
    <div id="content-container-center">
        <div id="choice">
            <div class="choice resulta">
                <div class="label">{{.OptionA}}</div>
                <div class="stat" id="optionA"></div>
            </div>
            <div class="divider"></div>
            <div class="choice resultb">
                <div class="label">{{.OptionB}}</div>
                <div class="stat" id="optionB"></div>
            </div>
        </div>
    </div>
</div>
<div id="result">
    <span id="totalVotes">No votes yet</span>
</div>
<script>
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsUrl = protocol + '//' + window.location.host + '/ws';
    const socket = new WebSocket(wsUrl);

    socket.onmessage = function(event) {
        // Make the body visible (opacity was 0 in CSS)
        document.body.style.opacity = 1;

        const data = JSON.parse(event.data);
        const total = data.voteCount;
        let optionAPercent = 50, optionBPercent = 50;
        if (total > 0) {
            optionAPercent = Math.round(data.optionA / total * 100);
            optionBPercent = 100 - optionAPercent;
        }
        statA = document.getElementById('optionA');
        statB = document.getElementById('optionB');
        statA.classList.remove('stat');
        statB.classList.remove('stat');
        statA.innerText = optionAPercent + '%';
        statB.innerText = optionBPercent + '%';
        document.getElementById('totalVotes').innerText = total + (total === 1 ? ' vote' : ' votes');
        document.getElementById('background-stats-1').style.width = optionAPercent + '%';
        document.getElementById('background-stats-2').style.width = optionBPercent + '%';
    };

    socket.onopen = function() {
        console.log('Connected to WebSocket');
        document.body.style.opacity = 1;
    };

    socket.onclose = function() {
        console.log('Disconnected');
    };
</script>
</body>
</html>